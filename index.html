<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal Priston Tale - Informa√ß√µes dos Bosses</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Portal completo com hor√°rios, drops e localiza√ß√£o dos bosses do Priston Tale">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PT Bosses">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="img/bosses/miniaturas/mini_valento.webp">
    <link rel="icon" type="image/png" sizes="32x32" href="img/bosses/miniaturas/mini_babel.webp">
    <link rel="icon" type="image/png" sizes="16x16" href="img/bosses/miniaturas/mini_kelvezu.webp">
    <!-- <link rel="manifest" href="/manifest.json"> --> <!-- Desabilitado para desenvolvimento local -->
    <link rel="mask-icon" href="img/bosses/miniaturas/mini_yagditha.webp" color="#4CAF50">
    <style>
        /* CSS Variables for Theme System */
        :root {
            --bg-primary: #121212;
            --bg-secondary: #1e1e1e;
            --bg-tertiary: #2a2a2a;
            --text-primary: #e0e0e0;
            --text-secondary: #90ee90;
            --text-accent: #4CAF50;
            --text-highlight: #FFD700;
            --border-color: #333;
            --border-accent: #4CAF50;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-bg: #333;
        }



        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            margin: 0;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        h1 {
            color: var(--text-accent);
            text-align: center;
            margin-bottom: 5px;
        }

        #current-time {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        /* Theme Toggle Styles */
        .theme-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
        }

        .profile-toggle, .favorites-toggle {
            background: var(--bg-secondary);
            border: 1px solid var(--border-accent);
            color: var(--text-accent);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .profile-toggle:hover, .favorites-toggle:hover {
            background: var(--text-accent);
            color: var(--bg-primary);
            transform: translateY(-1px);
        }

        .controls-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-around;
            gap: 20px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            width: 100%;
            gap: 5px;
        }

        .controls label {
            font-weight: bold;
        }

        .controls select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #4CAF50;
            background-color: #1e1e1e;
            color: #e0e0e0;
            width: 100%;
            cursor: pointer;
        }

        .server-column {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 4px 8px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .server-name {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--text-accent);
            margin-bottom: 15px;
            text-align: center;
        }

        /* Favorites System Styles */
        .favorite-star {
            position: absolute;
            top: 10px;
            right: 45px;
            font-size: 1.5em;
            cursor: pointer;
            color: #666;
            transition: all 0.3s ease;
            z-index: 10;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }

        .favorite-star.favorited {
            color: var(--text-highlight);
            transform: scale(1.2);
        }

        .favorite-star:hover {
            transform: scale(1.3);
            color: var(--text-highlight);
        }

        .favorites-filter {
            background: var(--bg-secondary);
            border: 1px solid var(--border-accent);
            color: var(--text-accent);
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .favorites-filter.active {
            background: var(--text-accent);
            color: var(--bg-primary);
        }

        /* Profile Panel Styles */
        .profile-panel {
            position: fixed;
            top: 0;
            left: -400px;
            width: 350px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 2px solid var(--border-accent);
            z-index: 1001;
            transition: left 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .profile-panel.open {
            left: 0;
        }

        .profile-content {
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .profile-content h3 {
            color: var(--text-accent);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-accent);
            padding-bottom: 10px;
        }

        .profile-stats {
            margin-bottom: 30px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .stat-item label {
            color: var(--text-primary);
            font-weight: 500;
        }

        .stat-item span {
            color: var(--text-accent);
            font-weight: bold;
        }

        .profile-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .action-btn {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-accent);
            color: var(--text-primary);
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }

        .action-btn:hover {
            background: var(--text-accent);
            color: var(--bg-primary);
        }

        .action-btn.danger {
            border-color: #f44336;
            color: #f44336;
        }

        .action-btn.danger:hover {
            background: #f44336;
            color: white;
        }

        .close-panel {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: var(--text-accent);
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .close-panel:hover {
            transform: scale(1.2);
        }

        /* PWA Install Banner Styles */
        .pwa-install-banner {
            background: linear-gradient(135deg, var(--text-accent), #66bb6a);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            animation: slideInDown 0.5s ease;
        }

        .pwa-content {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .pwa-icon {
            font-size: 2em;
            min-width: 50px;
        }

        .pwa-text {
            flex: 1;
        }

        .pwa-text strong {
            font-size: 1.1em;
            display: block;
            margin-bottom: 5px;
        }

        .pwa-text p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.9em;
        }

        .pwa-install-btn {
            background: white;
            color: var(--text-accent);
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .pwa-install-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .pwa-dismiss-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .pwa-dismiss-btn:hover {
            opacity: 1;
        }

        @keyframes slideInDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .subservers-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
        }

        .subservidor {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #2a2a2a;
            padding: 10px 15px;
            border-radius: 4px;
            border-left: 3px solid #4CAF50;
        }

        .subservidor-name {
            font-weight: bold;
        }

        .subservidor-time {
            font-size: 1.2em;
            font-weight: bold;
            color: #FFD700;
        }

        .sound-toggle {
            margin-top: 20px;
            padding: 10px 15px;
            border: 1px solid #4CAF50;
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            text-align: center;
        }

        .sound-toggle:hover {
            background-color: #2a2a2a;
        }

        .boss-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px var(--shadow-color);
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            text-align: left;
            gap: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .boss-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px var(--shadow-color);
        }

        .boss-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            min-width: 200px;
            flex-shrink: 0;
        }

        .boss-header img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: containcover;
            border: 2px solid #4CAF50;
        }
        
        .boss-header .boss-spawn-img {
            width: 100px;
            border-radius: 4px;
            border: 1px solid #000000;
            margin-top: 5px;
            transition: transform 0.3s ease;
            cursor: pointer;
            

        }
        .boss-header .boss-spawn-img:hover {
            transform: scale(2.5);
            z-index: 1000;
            position: relative;
            border: 2px solid #000000;
        }
        
        .boss-header h2 {
            margin: 0;
            color: #e0e0e0;
            text-align: left;
            width: 100%;
        }

        .boss-info {
            flex: 1;
            text-align: left;
        }

        .boss-info p {
            margin: 8px 0;
            line-height: 1.5;
        }

        .section-title {
            color: #4CAF50;
            font-size: 1.1em;
            margin-top: 20px;
            margin-bottom: 8px;
            text-align: left;
            width: 100%;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        ul {
            list-style-type: none;
            padding: 0;
            margin: 0 0 10px 0;
            width: 100%;
            text-align: left;
        }

        li {
            background-color: #2a2a2a;
            border-left: 3px solid #4CAF50;
            padding: 12px 15px;
            margin-bottom: 6px;
            border-radius: 4px;
            line-height: 1.4;
            transition: background-color 0.2s ease;
        }

        li:hover {
            background-color: #333;
        }

        .highlight {
            color: #FFD700;
            font-weight: bold;
        }

        .whatsapp-float {
            position: fixed;
            width: 60px;
            height: 60px;
            bottom: 20px;
            right: 20px;
            background-color: #25d366;
            color: #FFF;
            border-radius: 50px;
            text-align: center;
            box-shadow: 2px 2px 3px #999;
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.3s ease-in-out;
        }

        .whatsapp-float img {
            width: 35px;
            height: 35px;
        }

        .whatsapp-float:hover {
            transform: scale(1.1);
        }

        /* Navigation Styles */
        .nav-container {
            background-color: #1e1e1e;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #333;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background-color: #2a2a2a;
            color: #e0e0e0;
            border: none;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            border-radius: 8px 8px 0 0;
            margin-right: 2px;
        }

        .nav-tab:last-child {
            margin-right: 0;
        }

        .nav-tab:hover {
            background-color: #3a3a3a;
            color: #4CAF50;
        }

        .nav-tab.active {
            background-color: #4CAF50;
            color: #121212;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Event Styles */
        .event-card, .sort-card {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .event-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .event-header h2 {
            color: #4CAF50;
            margin: 0;
            text-align: center;
        }

        .event-header img {
            width: 120px;
            height: auto;
            border-radius: 8px;
            border: 2px solid #4CAF50;
            transition: transform 0.3s ease, width 0.5s ease-in-out;
            cursor: pointer;
        }

        .event-header img:hover {
            transform: scale(1.05);
            width: 300px;
        }

        .event-info {
            background-color: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .event-answers {
            margin-bottom: 15px;
        }

        .event-answers h3 {
            color: #4CAF50;
            margin-bottom: 10px;
        }

        .answer-item {
            background-color: #333;
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            border-left: 3px solid #FFD700;
        }

        .event-location {
            margin-top: 15px;
        }

        .event-location h4 {
            color: #4CAF50;
            margin-bottom: 8px;
        }

        .location-info {
            background-color: #333;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid #FF6B6B;
        }

        .frequency-info {
            background-color: #2d4a3d;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
            border-left: 3px solid #4CAF50;
            font-weight: bold;
        }

        /* Timer and Notifications Styles */
        .timer-section {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 200px;
            background-color: rgba(30, 30, 30, 0.3);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-radius: 8px;
            padding: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 999;
            backdrop-filter: blur(5px);
            transform: scale(0.85);
            opacity: 0.4;
            transition: all 0.3s ease;
        }

        .timer-section.scrolling {
            opacity: 0.3;
            transform: scale(0.8);
            pointer-events: none;
        }

        .timer-section.no-scroll-fade {
            opacity: 0.4 !important;
            transform: scale(0.85) !important;
            pointer-events: auto !important;
        }

        .timer-section.no-scroll-fade.scrolling {
            opacity: 0.4 !important;
            transform: scale(0.85) !important;
            pointer-events: auto !important;
        }

        .timer-section:hover {
            opacity: 1 !important;
            transform: scale(1) !important;
            pointer-events: auto !important;
            background-color: rgba(30, 30, 30, 0.95);
            border-color: #4CAF50;
            width: 280px;
            padding: 15px;
        }

        .timer-section.expanded {
            width: 280px;
            padding: 15px;
            opacity: 1;
            transform: scale(1);
            background-color: rgba(30, 30, 30, 0.95);
            border-color: #4CAF50;
        }

        .timer-section.expanded .notification-controls {
            display: block !important;
        }

        .timer-section .notification-controls {
            display: none;
        }

        .timer-controls {
            position: absolute;
            top: 5px;
            right: 8px;
            display: flex;
            gap: 5px;
        }

        .timer-toggle, .settings-toggle {
            background: transparent;
            border: none;
            color: #4CAF50;
            cursor: pointer;
            font-size: 1em;
            padding: 2px;
            border-radius: 3px;
            transition: background-color 0.3s;
        }

        .timer-toggle:hover, .settings-toggle:hover {
            background-color: rgba(76, 175, 80, 0.2);
        }

        .timer-toggle.active {
            color: #FFD700;
            background-color: rgba(76, 175, 80, 0.2);
        }

        .timer-section h3 {
            color: #4CAF50;
            margin: 0 0 10px 0;
            font-size: 1.1em;
            text-align: center;
        }

        .countdown-timer {
            font-size: 1.5em;
            font-weight: bold;
            color: #FFD700;
            margin: 5px 0;
            text-shadow: 0 0 8px rgba(255, 215, 0, 0.5);
            text-align: center;
        }

        .next-boss-info {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            margin: 8px 0;
            border-left: 3px solid #4CAF50;
        }

        .next-boss-name {
            font-size: 1em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 3px;
        }

        .next-boss-location {
            color: #90ee90;
            font-size: 0.9em;
            margin-bottom: 3px;
        }

        .notification-controls {
            background-color: #2a2a2a;
            padding: 10px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .notification-controls h4 {
            color: #4CAF50;
            margin: 0 0 8px 0;
            font-size: 0.95em;
        }

        .sound-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            gap: 5px;
        }

        .sound-control label {
            color: #e0e0e0;
            font-size: 0.85em;
            min-width: 70px;
        }

        .sound-toggle-btn {
            padding: 4px 8px;
            border: 1px solid #4CAF50;
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8em;
            flex: 1;
            text-align: center;
        }

        .sound-toggle-btn:hover {
            background-color: #4CAF50;
            color: #121212;
        }

        .sound-toggle-btn.active {
            background-color: #4CAF50;
            color: #121212;
        }

        .sound-select {
            padding: 4px;
            border: 1px solid #4CAF50;
            background-color: #1e1e1e;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 0.8em;
            flex: 1;
            cursor: pointer;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 5px;
            flex: 1;
        }

        .volume-slider {
            width: 60px;
            height: 4px;
            border-radius: 2px;
            background: #333;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }

        .volume-display {
            font-size: 0.75em;
            color: #90ee90;
            min-width: 30px;
        }

        .warning-timer {
            color: #FF6B6B !important;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        /* Hide timer on small screens */
        @media (max-width: 1200px) {
            .timer-section {
                position: relative;
                top: auto;
                right: auto;
                width: 100%;
                margin-bottom: 20px;
            }
        }

        /* Adjust main content margin for large screens */
        @media (min-width: 1201px) {
            .container {
                max-width: calc(100vw - 340px);
                margin-left: auto;
                margin-right: auto;
                padding-right: 0;
            }
        }

        @media (max-width: 768px) {
            .boss-card {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }

            .boss-header {
                width: 100%;
                align-items: center;
                text-align: center;
                margin-bottom: 15px;
            }

            .boss-header h2 {
                text-align: center;
            }

            .boss-info {
                width: 100%;
            }
        }

        @media (min-width: 600px) {
            .controls-container {
                flex-direction: row;
            }

            .boss-header img {
                width: 100px;
                height: 100px;
            }

            .boss-header .boss-spawn-img {
                width: 120px;
            }

            .boss-header .boss-spawn-img:hover {
                transform: scale(3);
                z-index: 1000;
                position: relative;
                
            }

            .nav-tab {
                font-size: 1.1em;
                padding: 18px 25px;
            }

            .event-header {
                flex-direction: row;
                justify-content: flex-start;
                align-items: center;
            }

            .event-header img {
                width: 150px;
                margin-right: 20px;
            }

            .event-header img:hover {
                width: 400px;
            }
        }
        .lottery-container {
    max-width: 600px;
    margin: 20px auto;
    padding: 20px;
}

.lottery-form {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 30px;
    text-align: center;
}

.lottery-text {
    font-size: 2em;
    font-weight: bold;
    color: var(--text-primary);
    margin-bottom: 30px;
    line-height: 1.5;
}

.range-section {
    margin-top: 15px;
}

.lottery-input {
    background: var(--bg-tertiary);
    border: 2px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-accent);
    font-size: 1.2em;
    font-weight: bold;
    padding: 10px;
    text-align: center;
    width: 80px;
    margin: 0 5px;
    transition: all 0.3s ease;
}

.lottery-input:focus {
    outline: none;
    border-color: var(--text-accent);
    background: var(--bg-primary);
}

.range-input {
    width: 100px;
}

.options-section {
    margin: 30px 0;
}

.options-toggle {
    width: 100%;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-primary);
    padding: 15px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: bold;
    transition: all 0.3s ease;
}

.options-toggle:hover {
    background: var(--hover-bg);
    border-color: var(--text-accent);
}

.options-content {
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 8px 8px;
    padding: 20px;
    text-align: left;
}

.option-item {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    color: var(--text-primary);
    cursor: pointer;
    gap: 10px;
}

.option-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: var(--text-accent);
}

.lottery-button {
    width: 100%;
    background: linear-gradient(135deg, var(--text-accent), #66bb6a);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 1.5em;
    font-weight: bold;
    padding: 15px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    margin-top: 20px;
}

.lottery-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
}

.lottery-results {
    background: var(--bg-secondary);
    border: 2px solid var(--text-accent);
    border-radius: 8px;
    padding: 30px;
    margin-top: 30px;
    text-align: center;
}

.lottery-results h3 {
    color: var(--text-accent);
    margin: 0 0 20px 0;
    font-size: 1.5em;
}

.results-display {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 15px;
    margin: 20px 0;
    min-height: 60px;
    align-items: center;
}

.result-number {
    background: linear-gradient(135deg, var(--text-accent), #66bb6a);
    color: white;
    font-size: 1.5em;
    font-weight: bold;
    padding: 15px;
    border-radius: 50%;
    min-width: 50px;
    min-height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeInScale 0.5s ease;
}

.results-actions {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin: 25px 0 15px 0;
}

.results-actions button {
    background: var(--bg-tertiary);
    border: 1px solid var(--text-accent);
    border-radius: 6px;
    color: var(--text-accent);
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.results-actions button:hover {
    background: var(--text-accent);
    color: white;
}

.draw-info {
    color: var(--text-secondary);
    font-size: 0.9em;
    margin-top: 15px;
}

@keyframes fadeInScale {
    from {
        opacity: 0;
        transform: scale(0.5);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

        @media (max-width: 768px) {
            .lottery-text {
                font-size: 1.5em;
            }
            
            .lottery-input {
                font-size: 1em;
                width: 60px;
            }
            
            .range-input {
                width: 80px;
            }
            
            .results-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .results-actions button {
                width: 150px;
            }
        }

        /* Help Modal Styles */
        .help-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            z-index: 10000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }

        .help-modal-overlay.show {
            display: flex;
        }

        .help-modal {
            background: var(--bg-secondary);
            border: 2px solid var(--border-accent);
            border-radius: 12px;
            padding: 25px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease;
            margin: 20px;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .help-modal h3 {
            color: var(--text-accent);
            text-align: center;
            margin: 0 0 20px 0;
            font-size: 1.5em;
            border-bottom: 2px solid var(--border-accent);
            padding-bottom: 10px;
        }

        .help-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: transparent;
            border: none;
            color: var(--text-accent);
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .help-close:hover {
            transform: scale(1.2);
        }

        .help-section {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--text-accent);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
        }

        .help-section h4 {
            color: var(--text-accent);
            margin: 0 0 10px 0;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .help-section p {
            color: var(--text-primary);
            margin: 5px 0;
            line-height: 1.5;
        }

        .help-example {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 0.9em;
            color: var(--text-secondary);
        }

        .help-timeline {
            background: var(--bg-primary);
            border-radius: 6px;
            padding: 15px;
            margin: 10px 0;
        }

        .help-timeline-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            padding: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
        }

        .help-timeline-icon {
            font-size: 1.2em;
            min-width: 25px;
        }

                 .help-tip {
             background: linear-gradient(135deg, #ff9800, #ff5722);
             color: white;
             padding: 12px;
             border-radius: 6px;
             margin: 15px 0;
             font-weight: bold;
             text-align: center;
         }

         /* Help Modal Mobile Responsiveness */
         @media (max-width: 768px) {
             .help-modal {
                 max-width: 95%;
                 margin: 10px;
                 padding: 20px;
                 max-height: 90vh;
             }
             
             .help-modal h3 {
                 font-size: 1.3em;
             }
             
             .help-section h4 {
                 font-size: 1.1em;
             }
             
             .help-timeline-item {
                 flex-direction: column;
                 align-items: flex-start;
                 text-align: left;
             }
             
             .help-timeline-icon {
                 align-self: center;
                 margin-bottom: 5px;
             }
         }
    </style>
</head>
<body>

<!-- Profile Controls -->
<div class="theme-controls">
    <button class="profile-toggle" onclick="toggleProfilePanel()" title="Perfil do Usu√°rio">üë§</button>
    <button class="favorites-toggle" id="favorites-toggle" onclick="toggleFavoritesFilter()" title="Mostrar Favoritos">‚≠ê</button>
</div>

<!-- Profile Panel -->
<div class="profile-panel" id="profile-panel">
    <div class="profile-content">
        <h3>üë§ Perfil do Usu√°rio</h3>
        <div class="profile-stats">
            <div class="stat-item">
                <label>Bosses Favoritos:</label>
                <span id="favorites-count">0</span>
            </div>
            <div class="stat-item">
                <label>Notifica√ß√µes:</label>
                <span id="notification-status">Desabilitadas</span>
            </div>
        </div>
        <div class="profile-actions">
            <button onclick="testNotification()" class="action-btn">üîî Testar Notifica√ß√£o</button>
            <button onclick="exportProfile()" class="action-btn">üì§ Exportar Configura√ß√µes</button>
            <button onclick="importProfile()" class="action-btn">üì• Importar Configura√ß√µes</button>
            <button onclick="clearProfile()" class="action-btn danger">üóëÔ∏è Limpar Dados</button>
        </div>
        <button class="close-panel" onclick="toggleProfilePanel()">‚ùå</button>
    </div>
</div>

<div class="container">
    <h1>Portal de Informa√ß√µes Priston Tale</h1>
    <p id="current-time"></p>
    
    <!-- PWA Install Banner -->
    <div class="pwa-install-banner" id="pwa-banner" style="display: none;">
        <div class="pwa-content">
            <div class="pwa-icon">üì±</div>
            <div class="pwa-text">
                <strong>Instalar App</strong>
                <p>Adicione o Portal PT √† sua tela inicial para acesso r√°pido!</p>
            </div>
            <button class="pwa-install-btn" id="pwa-install-btn">Instalar</button>
            <button class="pwa-dismiss-btn" onclick="dismissPWABanner()">‚úï</button>
        </div>
    </div>

    <!-- Navigation Menu -->
    <div class="nav-container">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('bosses')">üêâ Bosses</button>
            <button class="nav-tab" onclick="switchTab('events')">üéØ Eventos</button>
            <button class="nav-tab" onclick="switchTab('sort')">üçÄ Sorteio</button>
            <!-- <button class="nav-tab" onclick="switchTab('agecalc')">üìà Age Calc</button>  -->
            <button class="nav-tab" onclick="switchTab('attwill')">Atualiza√ß√µes Futuras</button>
        </div>
    </div>

    <!-- Bosses Tab Content -->
    <div id="bosses-content" class="tab-content active">
        <div class="controls-container">
            <div class="controls">
                <div class="control-group">
                    <label for="filter-select">Filtro de Item:</label>
                    <select id="filter-select">
                        <option value="all">Todos os Itens</option>
                        <option value="Receita de Rel√≠quias">Receita de Rel√≠quias</option>
                        <option value="Anel do Valento">Anel do Valento</option>
                        <option value="Colar do Kelvezu">Colar do Kelvezu</option>
                        <option value="Botas do Mokova">Botas do Mokova</option>
                        <option value="Anel Shy">Anel Shy</option>
                        <option value="Amuleto Tulla">Amuleto Tulla</option>
                        <option value="Botas do Draxos">Botas do Draxos</option>
                        <option value="Luvas do Greedy">Luvas do Greedy</option>
                        <option value="Amuleto do Yagditha">Amuleto do Yagditha</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="time-filter-select">Filtro por Hor√°rio:</label>
                    <select id="time-filter-select">
                        <option value="all">Todos os Hor√°rios</option>
                        <script>
                            // Gera as op√ß√µes de hor√°rio dinamicamente de 00 a 23
                            for (let i = 0; i < 24; i++) {
                                const hour = String(i).padStart(2, '0');
                                document.write(`<option value="${i}">${hour}hXX</option>`);
                            }
                        </script>
                    </select>
                </div>
                <div class="control-group">
                    <label for="sort-select">Ordena√ß√£o:</label>
                    <select id="sort-select">
                        <option value="next-spawn">Hor√°rio de Pr√≥xima Apari√ß√£o</option>
                        <option value="Receita de Rel√≠quias">Receita de Rel√≠quias</option>
                        <option value="Anel do Valento">Anel do Valento</option>
                        <option value="Colar do Kelvezu">Colar do Kelvezu</option>
                        <option value="Botas do Mokova">Botas do Mokova</option>
                        <option value="Anel Shy">Anel Shy</option>
                        <option value="Amuleto Tulla">Amuleto Tulla</option>
                        <option value="Botas do Draxos">Botas do Draxos</option>
                        <option value="Luvas do Greedy">Luvas do Greedy</option>
                        <option value="Amuleto do Yagditha">Amuleto do Yagditha</option>
                    </select>
                </div>
            </div>
            <div class="server-column">
                <div class="server-name">IDHAS</div>
                <div class="subservers-container" id="subservers-container">
                </div>
            </div>
        </div>
        
        <div id="bosses-container"></div>
    </div>

    <!-- Fixed Timer Section (only visible on large screens) -->
    <div class="timer-section" id="timer-section">
        <div class="timer-controls">
            <button class="timer-toggle" id="pin-toggle" onclick="toggleScrollFade()" title="Fixar/Desfixar">üìå</button>
            <button class="settings-toggle" onclick="toggleSettings()" title="Configura√ß√µes">‚öôÔ∏è</button>
            <button class="settings-toggle" onclick="showHelpModal()" title="Ajuda - O que cada controle faz">‚ùì</button>
        </div>
        <h3>‚è∞ Pr√≥ximo Boss</h3>
        <div class="next-boss-info" id="next-boss-info">
            <div class="next-boss-name" id="next-boss-name">Carregando...</div>
            <div class="next-boss-location" id="next-boss-location">üìç Carregando...</div>
            <div class="countdown-timer" id="countdown-timer">--:--:--</div>
        </div>
        
        <div class="notification-controls" id="notification-controls">
            <h4>üîî Notifica√ß√µes</h4>
            <div class="sound-control">
                <label>Som:</label>
                <button class="sound-toggle-btn" id="sound-toggle" onclick="toggleSound()">üîá OFF</button>
            </div>
            <div class="sound-control">
                <label>Tipo:</label>
                <select class="sound-select" id="sound-type-select" onchange="changeSoundType()">
                    <option value="beep">üéµ Beep</option>
                    <option value="chime">üîî Chime</option>
                    <option value="alert">üö® Alert</option>
                    <option value="bell">üîî Bell</option>
                    <option value="horn">üìØ Horn</option>
                    <option value="whistle">üé∫ Whistle</option>
                </select>
            </div>
            <div class="sound-control">
                <label>Aviso:</label>
                <button class="sound-toggle-btn" id="early-warning-toggle" onclick="toggleEarlyWarning()">‚ö†Ô∏è OFF</button>
            </div>
            <div class="sound-control">
                <label>Vol:</label>
                <div class="volume-control">
                    <input type="range" class="volume-slider" id="volume-slider" min="0" max="100" value="50" onchange="updateVolume()">
                    <span class="volume-display" id="volume-display">50%</span>
                </div>
            </div>
            <div class="sound-control">
                <label>Notif:</label>
                <button class="sound-toggle-btn" id="notification-toggle" onclick="toggleNotifications()">üîî OFF</button>
            </div>
        </div>
    </div>

    <!-- Events Tab Content -->
    <div id="events-content" class="tab-content">
        <div class="event-card">
            <div class="event-header">
                <img src="https://ptlab.com.br/wp-content/uploads/2024/01/vale-tranquilo-i7.png" alt="Cientista Marie - Vale Tranquilo" class="event-spawn-img">
                <div>
                    <h2>Cientista Marie</h2>
                    <p style="color: #90ee90; font-size: 1.1em; margin: 5px 0;">üìç Vale Tranquilo i7 (Cachoeira)</p>
                </div>
            </div>
            
            <div class="event-info">
                <div class="event-answers">
                    <h3>‚úÖ Respostas (Nessa ordem):</h3>
                    <div class="answer-item">1¬∞ - Pedra Idetas</div>
                    <div class="answer-item">2¬∞ - Gold</div>
                    <div class="answer-item">3¬∞ - Mago</div>
                    <div class="answer-item">4¬∞ - T√¥nico Capilar</div>
                </div>
                
                <div class="event-location">
                    <h4>üìã Informa√ß√µes Importantes:</h4>
                    <div class="location-info">
                        ‚Ä¢ A recompensa ir√° para o seu distribuidor, abra a recompensa e voc√™ ganhar√° outra recompensa.
                    </div>
                    <div class="location-info">
                        ‚Ä¢ Para trocar a engrenagem e a prece, v√° at√© o quadrante D5 (Rind Violenta), na cidade de Pillai (qualquer sub-servidor).
                    </div>
                    <div class="frequency-info">
                        üïê Frequ√™ncia: 1 vez ao dia
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Road Map Tab Content -->
    <div id="attwill-content" class="tab-content">
        <div class="sort-card" style="border: 2px dashed #4CAF50; background-color: #1a2a1a;">
            <div style="text-align: center; padding: 20px; color: #4CAF50;">
                <h3>üöÄ Em Desenvolvimento</h3>
                <p style="color: #90ee90; margin-bottom: 15px;">Pr√≥ximas funcionalidades que ser√£o implementadas:</p>
                <div style="text-align: left; max-width: 500px; margin: 0 auto;">
                    <div style="background-color: #2a2a2a; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #FFD700;">
                        üì§ <strong>Compartilhamento:</strong> Compartilhe hor√°rios espec√≠ficos com amigos
                    </div>
                    <div style="background-color: #2a2a2a; padding: 10px; margin: 5px 0; border-radius: 5px; border-left: 3px solid #FFD700;">
                        üì§ <strong>Age Calc:</strong> √© uma calculadora de "aging" que permite aos jogadores prever o resultado de aumentar os atributos de um item ("Aging") ou calcular os atributos originais de um item com "aging" para verificar se √© "perfeito". Essas ferramentas s√£o √∫teis para simular os efeitos do processo de "Aging" em armas e armaduras, levando em conta os diferentes status como defesa, ataque, cr√≠tico, e bloqueio, com a possibilidade de incluir a fun√ß√£o "Despertado".  
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sort Tab Content -->
    <div id="sort-content" class="tab-content">
        <div class="sort-card">
            <div class="sort-info">
                <div class="sort-card">
                    <div class="lottery-container">
                        <form class="lottery-form" id="lottery-form">
                            <div class="lottery-text">
                                Sortear 
                                <input type="number" id="quantity" min="1" max="100" value="1" class="lottery-input">
                                n√∫mero
                                <div class="range-section">
                                    entre 
                                    <input type="number" id="min-range" min="0" max="999999" value="1" class="lottery-input range-input">
                                    e 
                                    <input type="number" id="max-range" min="1" max="999999" value="100" class="lottery-input range-input">
                                </div>
                            </div>

                            <div class="options-section">
                                <button type="button" class="options-toggle" onclick="toggleLotteryOptions()">
                                    <span>Op√ß√µes do Sorteio</span>
                                    <span class="arrow">‚ñº</span>
                                </button>
                                
                                <div class="options-content" id="lottery-options" style="display: none;">
                                    <label class="option-item">
                                        <input type="checkbox" id="allow-repeats" checked>
                                        Permitir n√∫meros repetidos
                                    </label>
                                    <label class="option-item">
                                        <input type="checkbox" id="sort-results">
                                        Ordenar resultados
                                    </label>
                                </div>
                            </div>

                            <button type="submit" class="lottery-button">
                                SORTEAR AGORA!
                            </button>
                        </form>

                        <div class="lottery-results" id="lottery-results" style="display: none;">
                            <h3>Resultado do Sorteio</h3>
                            <div class="results-display" id="results-display"></div>
                            <div class="results-actions">
                                <button type="button" onclick="copyResults()">Copiar</button>
                                <button type="button" onclick="newDraw()">Novo Sorteio</button>
                            </div>
                            <div class="draw-info">
                                <small>Sorteado em: <span id="draw-time"></span></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Placeholder for future social features -->
        
    </div>    

    <a href="https://wa.me/55067996456868" class="whatsapp-float" target="_blank" aria-label="Fale no WhatsApp">
        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp" />
    </a>
</div>

<!-- Help Modal -->
<div class="help-modal-overlay" id="help-modal-overlay" onclick="closeHelpModal()">
    <div class="help-modal" onclick="event.stopPropagation()">
        <button class="help-close" onclick="closeHelpModal()">‚úï</button>
        <h3>‚ùì Guia dos Controles de Notifica√ß√£o</h3>
        
        <div class="help-section">
            <h4>üîä Som</h4>
            <p><strong>O que faz:</strong> Toca um √°udio no navegador quando o boss est√° chegando</p>
            <p><strong>Quando toca:</strong> 1 minuto antes e quando o boss nasce</p>
            <p><strong>Requisito:</strong> Voc√™ precisa estar com a aba aberta para ouvir</p>
        </div>

        <div class="help-section">
            <h4>‚ö†Ô∏è Aviso</h4>
            <p><strong>O que faz:</strong> Ativa um alerta antecipado de 5 minutos</p>
            <p><strong>Quando dispara:</strong> 5 minutos antes do boss aparecer</p>
            <p><strong>Som especial:</strong> Toca um som tipo "chime" (diferente do som normal)</p>
            <p><strong>Combinado com:</strong> Tamb√©m envia notifica√ß√£o visual (se habilitada)</p>
        </div>

        <div class="help-section">
            <h4>üîî Notif</h4>
            <p><strong>O que faz:</strong> Mostra notifica√ß√£o visual do sistema operacional</p>
            <p><strong>Funciona:</strong> Mesmo quando voc√™ est√° em outra aba ou aplicativo</p>
            <p><strong>Aparece:</strong> Na √°rea de notifica√ß√µes do Windows/Mac/Linux</p>
            <p><strong>Persist√™ncia:</strong> Bosses favoritos ficam at√© voc√™ fechar, outros somem em 5s</p>
        </div>

        <div class="help-section">
            <h4>üéµ Tipo</h4>
            <p><strong>O que faz:</strong> Escolhe o estilo de som que ser√° tocado</p>
            <p><strong>Op√ß√µes:</strong> Beep, Chime, Alert, Bell, Horn, Whistle</p>
        </div>

        <div class="help-section">
            <h4>üîä Vol</h4>
            <p><strong>O que faz:</strong> Controla o volume do som (0% a 100%)</p>
        </div>

        <div class="help-timeline">
            <h4 style="color: var(--text-accent); text-align: center; margin-bottom: 15px;">üìÖ Timeline de Notifica√ß√µes</h4>
            
            <div class="help-timeline-item">
                <span class="help-timeline-icon">‚ö†Ô∏è</span>
                <div>
                    <strong>5 minutos antes</strong> (SE "Aviso" = ON)<br>
                    üîä Som: Chime + üîî Notifica√ß√£o visual
                </div>
            </div>
            
            <div class="help-timeline-item">
                <span class="help-timeline-icon">üö®</span>
                <div>
                    <strong>1 minuto antes</strong> (SE "Som" = ON)<br>
                    üîä Som: Alert + üîî Notifica√ß√£o visual
                </div>
            </div>
            
            <div class="help-timeline-item">
                <span class="help-timeline-icon">üêâ</span>
                <div>
                    <strong>Boss nasce</strong> (SE "Som" = ON)<br>
                    üîä Som: Alert + üîî Notifica√ß√£o visual
                </div>
            </div>
        </div>

        <div class="help-tip">
            üí° <strong>Dica:</strong> Para receber notifica√ß√µes mesmo fora da aba, ative "üîî Notif" e permita notifica√ß√µes no navegador!
        </div>

        <div class="help-example">
            <strong>Configura√ß√£o recomendada:</strong><br>
            üîä Som: ON | ‚ö†Ô∏è Aviso: ON | üîî Notif: ON<br>
            = M√°ximo de alertas para n√£o perder nenhum boss!
        </div>
    </div>
</div>

<script>
    const allBossesData = [
        {
            nome: "Babel", local: "Estrada de Ferro do Caos (Iron 1)", horarios: [0, 3, 6, 9, 12, 15, 18, 21],
            drop: ["Itens do mapa, Ess√™ncia do Babel e Receita de Rel√≠quias (0,60% de chance)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_babel.webp",
            spaw : "img/bosses/maps/estrada-de-ferro-do-caos.png"
        },
        {
            nome: "Babel", local: "Cora√ß√£o de Perum (Iron 2)", horarios: [1, 4, 7, 10, 13, 16, 19, 22],
            drop: ["Itens do mapa, Ess√™ncia do Babel e Receita de Rel√≠quias (0,60% de chance)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_babel.webp",
            spaw : "img/bosses/maps/coracao-de-perum.png"
        },
        {
            nome: "F√∫ria", local: "Templo Maldito - 3¬∞ Andar (S3)", horarios: [2, 5, 8, 11, 14, 17, 20, 23],
            drop: ["Itens do mapa, Ess√™ncia do F√∫ria e Receita de Rel√≠quias (1,20% de chance)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_furia.webp",
            spaw : "img/bosses/maps/templo-maldito-3.png"
        },
        {
            nome: "Valento", local: "Vale Gallubia (ICE2)", horarios: [1, 5, 9, 13, 17, 21],
            drop: ["Itens do mapa, Ess√™ncia do Valento e Receita de Rel√≠quias (1,60% de chance), e Anel do Valento (0,17% de Chance, e 0,19% no Omega)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_valento.webp",
            spaw : "img/bosses/maps/vale-gallubia.png"
        },
        {
            nome: "Kelvezu", local: "Covil do Kelvezu", horarios: [1, 7, 13, 19],
            drop: ["Itens do mapa, Ess√™ncia do Kelvezu e Receita de Rel√≠quias (1,20% de chance), e Colar do Kelvezu (0,17% de Chance, e 0,19% no Omega)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_kelvezu.webp",
            spaw : "img/bosses/maps/covil-do-kelvezu.png"
        },
        {
            nome: "Mokova", local: "Templo Perdido (Lost 2)", horarios: [2, 8, 14, 20],
            drop: ["Itens do mapa, Ess√™ncia do Mokova e Botas do Mokova (0,14% de Chance, e 0,16% no Omega)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_mokova.webp",
            spaw : "img/bosses/maps/templo-perdido.png"
        },
        {
            nome: "Shy", local: "Torre Sem Fim 3¬∞ Andar (ET3)", horarios: [7, 15, 23],
            drop: ["Itens do mapa, Ess√™ncia do Shy e Receita de Rel√≠quias (1,60% de chance), e Anel Shy (0,14% de Chance, e 0,16% no Omega)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_shy.webp",
            spaw : "img/bosses/maps/torre-sem-fim-3-andar.png"
        },
        {
            nome: "Tulla", local: "Mina de Gelo (Mina)", horarios: [4, 12, 20],
            drop: ["Itens do mapa, Ess√™ncia do Tulla e Receita de Rel√≠quias (1,60% de chance), e Amuleto Tulla (0,14% de Chance, e 0,16% no Omega)."],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_tulla.webp",
            spaw : "img/bosses/maps/mina-de-gelo.png"
        },
        {
            nome: "Draxos", local: "Laborat√≥rio Secreto (Lab)", horarios: [9, 19],
            drop: ["Itens do mapa, Ess√™ncia do Draxos (2,40%), Receita de Rel√≠quia (2,40%), Botas do Draxos (0,14% de Chance, e 0,16% no Omega)"],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Mokova, Shy ou Tulla) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o do Draxos (10%), Runas Superiores (26%), Buff Especial (3H) (20%), Pergaminho de Invoca√ß√£o de Boss (Mokova, Shy ou Tulla) (15%), Itens de Ataque level 118 (17%), 33.766.200.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (10%)."],
            dano3: ["Pergaminho de Invoca√ß√£o do Draxos (10%), Caixa Priston (3H) (8%), Pergaminho de Invoca√ß√£o de Boss (Mokova, Shy ou Tulla) (15%), Itens de Defesa level 118 (21%), Itens de Ataque level 118 (21%), Ess√™ncia do Draxos (5%), 41.496.000.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (10%)."],
            img: "img/bosses/miniaturas/mini_draxos.webp",
            spaw : "img/bosses/maps/laboratorio-secreto.png"
        },
        {
            nome: "Greedy", local: "Arma Antiga (Arma)", horarios: [10, 21],
            drop: ["Itens do mapa, Ess√™ncia do Greedy e Receita de Rel√≠quias (2,40% de chance), e Luvas do Greedy (0,14% de Chance, e 0,16% no Omega)."],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Mokova, Shy ou Tulla) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o do Greedy (10%), Runas Superiores (26%), Buff Especial (3H) (20%), Pergaminho de Invoca√ß√£o de Boss (Tulla, Shy ou Draxos) (15%), Itens de Ataque level 123 (17%), 41.496.000.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (2%)."],
            dano3: ["Pergaminho de Invoca√ß√£o do Greedy (10%), Pergaminho de Invoca√ß√£o de Boss (Shy, Tulla ou Draxos) (15%), Ess√™ncias do Aging (I), (A) ou (S) (10%), Itens de Defesa level 123 (21%), Itens de Ataque level 123 (21%), Caixa Priston (3H) (8%), Ess√™ncia do Greedy (5%), ou 69.949.440.000 pontos de Experi√™ncia (5%)."],
            img: "img/bosses/miniaturas/mini_greedy.webp",
            spaw : "img/bosses/maps/arma-antiga.png"
        },
        {
            nome: "Espectro do<br>Midranda", local: "Estrada Sombria (Estrada)", horarios: [11, 19],
            drop: ["Itens do mapa, Receita de Rel√≠quia"],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Greedy, Tulla ou Draxos) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (10%), Runas Superiores (26%), Buff Especial (3H) (20%), Pergaminho de Invoca√ß√£o de Boss (Draxos, Tulla ou Greddy) (15%), Itens de Ataque level 130 (17%), 69.959.440.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (2%)."],
            dano3: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (10%), Pergaminho de Invoca√ß√£o de Boss (Greedy, Tulla ou Draxos) (15%), Ess√™ncias do Aging (I), (A) ou (S) (10%), Itens de Defesa level 130 (21%), Itens de Ataque level 130 (21%), Caixa Priston (3H) (8%), Ess√™ncias do Babel, F√∫ria, Valento, Kelvezu, Mokova, Shy, Tulla, Draxos ou Greedy (5%), ou 84.779.847.000 pontos de Experi√™ncia (5%)."],
            img: "img/bosses/miniaturas/mini_espectro.webp",
            spaw : "img/bosses/maps/estrada-sombria.png"
        },
        {
            nome: "Yagditha", local: "Abismo do Mar (AB1)", horarios: [20],
            drop: ["Itens do mapa, Ess√™ncia do Yagditha e Receita de Rel√≠quias (3,69% de chance), Amuleto do Yagditha (Alfa, Beta, Gama e Zeta) (0,16% de chance) Amuleto do Yagditha (Omega) (0,25% de chance)."],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Greedy, Draxos ou Espectro do Midranda) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (20%), Runas Superiores (26%), Buff Especial (3H) (15%), Pergaminho de Invoca√ß√£o de Boss (Draxos ou Greddy) (15%), Itens de Ataque level 140 (17%), 84.779.847.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (2%)."],
            dano3: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (10%), Pergaminho de Invoca√ß√£o de Boss (Greedy ou Draxos) (15%), Ess√™ncias do Aging (I), (A) ou (S) (15%), Itens de Defesa level 140 (21%), Itens de Ataque level 140 (21%), Caixa Priston (3H) (8%), Ess√™ncias do Yagditha (5%), ou 135.933.805.500 pontos de Experi√™ncia (5%)."],
            img: "img/bosses/miniaturas/mini_yagditha.webp",
            spaw : "img/bosses/maps/abismo-do-mar.png"
        },
        {
            nome: "Drag√£o Snowstorn", local: "Abismo do Mar Congelado (AB2)", horarios: [11, 22],
            drop: ["Itens do mapa"],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Greedy, Draxos ou Espectro do Midranda) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (20%), Runas Superiores (26%), Buff Especial (3H) (15%), Pergaminho de Invoca√ß√£o de Boss (Draxos ou Greddy) (15%), Itens de Ataque level 140 (17%), 135.933.805.500 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (2%)."],
            dano3: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (10%), Pergaminho de Invoca√ß√£o de Boss (Greedy ou Draxos) (15%), Ess√™ncias do Aging (I), (A) ou (S) (15%), Itens de Defesa level 140 (21%), Itens de Ataque level 140 (21%), Caixa Priston (3H) (8%), Ess√™ncias do Babel, Valento, Kelvezu, F√∫ria, Mokova, Tulla, Draxos, Greedy e Yagditha (5%), ou 150.878.802.000 pontos de Experi√™ncia (5%)."],
            img: "img/bosses/miniaturas/mini_snow.webp",
            spaw : "img/bosses/maps/abismo-do-mar-congelado.png"
        },
        {
            nome: "Midranda<br>Ressurgido", local: "Santu√°rio do Abismo (AB3)", horarios: [19],
            drop: ["Itens do mapa, Ess√™ncia do Midranda e Receita de Rel√≠quias (4,80% de chance), e Brinco do Midranda (Alfa, Beta, Gama e Zeta. 0,16% de chance) e (Omega 0,18% de chance)."],
            dano1: ["3x Sol (45%), 3x Meteoritos Idetas (12%), Runas Superiores (38%) ou Pergaminho de Invoca√ß√£o de Boss (Greedy, Espectro do Midranda ou Yagditha) (5%)."],
            dano2: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (20%), Runas Superiores (26%), Buff Especial (3H) (15%), Pergaminho de Invoca√ß√£o de Boss (Yagditha ou Greddy) (15%), Itens de Ataque level 140 (17%), 150.878.802.000 pontos de Experi√™ncia (5%) ou Ess√™ncias do Aging (I), (A) ou (S) (2%)."],
            dano3: ["Pergaminho de Invoca√ß√£o Espectro do Midranda (10%), Pergaminho de Invoca√ß√£o de Boss (Greedy ou Yagditha) (15%), Ess√™ncias do Aging (I), (A) ou (S) (15%), Itens de Defesa level 140 (21%), Itens de Ataque level 140 (21%), Caixa Priston (3H) (8%), Ess√™ncia do Midranda (5%), ou 199.600.125.000 pontos de Experi√™ncia (5%)."],
            img: "img/bosses/miniaturas/mini_midrandaress.webp",
            spaw : "img/bosses/maps/santuario-do-abismo.png"
        },
        {
            nome: "Maphinguary<br>(Evento)", local: "Mais Frequentado Santu√°rio do Abismo (AB1)<br><b>Outros Lugares:</b> AB3, Arma, Lab, Mina, Lost1, Ice2", horarios: [5,9,15,21,23],
            drop: ["Pelagem do Maphinguary, Tiara da Boitat√°, Penumbra do Tutu, Peruca da Kuca ou o Gorro do Hopiperor√™"],
            dano1: ["N√£o tem roleta"], dano2: ["N√£o tem roleta"], dano3: ["N√£o tem roleta"],
            img: "img/bosses/miniaturas/mini_maphinguary.jpg",
            spaw : "img/bosses/maps/abismo-do-mar-oposto.png"
        }
    ];


    const bossesContainer = document.getElementById('bosses-container');
    const timeDisplay = document.getElementById('current-time');
    const filterSelect = document.getElementById('filter-select');
    const timeFilterSelect = document.getElementById('time-filter-select');
    const sortSelect = document.getElementById('sort-select');
    const sheetUrl = 'https://script.google.com/macros/s/AKfycbxBOyU1-CxIpSqHJW94imrkMctg8WrbO7w8ZnWBmlyVRz53KaNklmyPbBVIdyluI246/exec';
    const subserversContainer = document.getElementById('subservers-container');
    
    // Vari√°vel global para armazenar os dados dos subservidores
    let serverTimesData = [];
    let serverDataLoaded = false; // Flag para controlar se os dados j√° foram carregados



    // Timer and notification elements
    const nextBossName = document.getElementById('next-boss-name');
    const nextBossLocation = document.getElementById('next-boss-location');
    const countdownTimer = document.getElementById('countdown-timer');
    
    // Notification settings
    let soundEnabled = false;
    let earlyWarningEnabled = false;
    let volume = 0.5;
    let soundType = 'beep';
    let lastNotifiedBoss = null;
    let audioContext = null;

    // Sound configurations
    const soundTypes = {
        beep: { frequencies: [800], durations: [200] },
        chime: { frequencies: [523, 659, 784], durations: [150, 150, 300] },
        alert: { frequencies: [1000, 800, 1000], durations: [100, 100, 200] },
        bell: { frequencies: [400, 500, 600, 500, 400], durations: [150, 150, 150, 150, 200] },
        horn: { frequencies: [300, 350, 400], durations: [300, 300, 400] },
        whistle: { frequencies: [1200, 1400, 1200], durations: [100, 200, 150] }
    };

    // Initialize audio context
    function initAudioContext() {
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
    }

    function getSaoPauloDate() {
    // Retorna um objeto Date ajustado para o fuso de S√£o Paulo
    const now = new Date();
    // Pega o hor√°rio local de S√£o Paulo usando Intl
    const parts = new Intl.DateTimeFormat('en-US', {
        timeZone: 'America/Sao_Paulo',
        year: 'numeric',
        month: '2-digit',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        hour12: false
    }).formatToParts(now);

    // Extrai as partes
    const year = parts.find(p => p.type === 'year').value;
    const month = parts.find(p => p.type === 'month').value;
    const day = parts.find(p => p.type === 'day').value;
    const hour = parts.find(p => p.type === 'hour').value;
    const minute = parts.find(p => p.type === 'minute').value;
    const second = parts.find(p => p.type === 'second').value;

    // Cria um novo Date no fuso de S√£o Paulo
    return new Date(`${year}-${month}-${day}T${hour}:${minute}:${second}`);
    }

    // Generate notification sound
    function playNotificationSound(customType = null) {
        if (!soundEnabled || !audioContext) return;
        
        const type = customType || soundType;
        const config = soundTypes[type];
        let time = audioContext.currentTime;
        
        config.frequencies.forEach((frequency, index) => {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            oscillator.type = 'sine';
            
            const duration = config.durations[index] / 1000;
            
            gainNode.gain.setValueAtTime(0, time);
            gainNode.gain.linearRampToValueAtTime(volume * 0.3, time + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.01, time + duration - 0.01);
            
            oscillator.start(time);
            oscillator.stop(time + duration);
            
            time += duration + 0.05; // Small gap between notes
        });
    }

    // Notification functions
    function toggleSound() {
        soundEnabled = !soundEnabled;
        const btn = document.getElementById('sound-toggle');
        
        if (soundEnabled) {
            initAudioContext();
            btn.textContent = 'üîä ON';
            btn.classList.add('active');
            playNotificationSound(); // Test sound
        } else {
            btn.textContent = 'üîá OFF';
            btn.classList.remove('active');
        }
    }

    function toggleEarlyWarning() {
        earlyWarningEnabled = !earlyWarningEnabled;
        const btn = document.getElementById('early-warning-toggle');
        
        if (earlyWarningEnabled) {
            btn.textContent = '‚ö†Ô∏è ON';
            btn.classList.add('active');
        } else {
            btn.textContent = '‚ö†Ô∏è OFF';
            btn.classList.remove('active');
        }
    }

    function changeSoundType() {
        const select = document.getElementById('sound-type-select');
        soundType = select.value;
        
        // Play test sound if enabled
        if (soundEnabled) {
            playNotificationSound();
        }
    }

    function updateVolume() {
        const slider = document.getElementById('volume-slider');
        const display = document.getElementById('volume-display');
        volume = slider.value / 100;
        display.textContent = slider.value + '%';
    }

    // Toggle notifications
    async function toggleNotifications() {
        if (userProfile.notificationsEnabled) {
            userProfile.notificationsEnabled = false;
            const btn = document.getElementById('notification-toggle');
            btn.textContent = 'üîî OFF';
            btn.classList.remove('active');
            saveProfile();
        } else {
            await requestNotificationPermission();
            const btn = document.getElementById('notification-toggle');
            if (userProfile.notificationsEnabled) {
                btn.textContent = 'üîî ON';
                btn.classList.add('active');
            }
        }
    }

    // Make functions global
    window.toggleSound = toggleSound;
    window.toggleEarlyWarning = toggleEarlyWarning;
    window.changeSoundType = changeSoundType;
    window.updateVolume = updateVolume;
    window.toggleNotifications = toggleNotifications;

    // Timer scroll behavior
    let scrollTimeout;
    let isScrollFadeDisabled = false;
    let isSettingsExpanded = false;

    function toggleScrollFade() {
        const timerSection = document.getElementById('timer-section');
        const pinToggle = document.getElementById('pin-toggle');
        
        isScrollFadeDisabled = !isScrollFadeDisabled;
        
        if (isScrollFadeDisabled) {
            timerSection.classList.add('no-scroll-fade');
            pinToggle.classList.add('active');
            pinToggle.title = 'Permitir transpar√™ncia no scroll';
        } else {
            timerSection.classList.remove('no-scroll-fade');
            pinToggle.classList.remove('active');
            pinToggle.title = 'Fixar/Desfixar';
        }
    }

    function toggleSettings() {
        const timerSection = document.getElementById('timer-section');
        
        isSettingsExpanded = !isSettingsExpanded;
        
        if (isSettingsExpanded) {
            timerSection.classList.add('expanded');
        } else {
            timerSection.classList.remove('expanded');
        }
    }

    function handleScroll() {
        const timerSection = document.getElementById('timer-section');
        
        if (!isScrollFadeDisabled) {
            // Add scrolling class immediately
            timerSection.classList.add('scrolling');
            
            // Clear existing timeout
            clearTimeout(scrollTimeout);
            
            // Remove scrolling class after user stops scrolling
            scrollTimeout = setTimeout(() => {
                timerSection.classList.remove('scrolling');
            }, 1000); // Wait 1 second after scroll stops
        }
    }

    // Add scroll event listener
    window.addEventListener('scroll', handleScroll);

    // Make functions global
    window.toggleScrollFade = toggleScrollFade;
    window.toggleSettings = toggleSettings;

    async function fetchServerTimes() {
        try {
            // console.log('üîÑ Iniciando carregamento dos dados dos subservidores...');
            // console.log('üåê URL:', sheetUrl);
            
            // Marca que est√° carregando
            serverDataLoaded = false;
            
            const response = await fetch(sheetUrl);
            // console.log('üì° Response status:', response.status, response.statusText);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            const data = await response.json(); // J√° √© um array de objetos
            // console.log('üìä Dados recebidos:', data);

            // Armazena os dados dos subservidores na vari√°vel global
            serverTimesData = data;
            // console.log('üíæ Dados armazenados em serverTimesData:', serverTimesData);

            // Remove conte√∫do anterior para evitar duplicatas
            subserversContainer.innerHTML = '';

            data.forEach(item => {
                const name = item.Idhas;
                const time = item.Horario;
                // console.log(`üìù Processando: ${name} = ${time}`);
                // console.log(`üìù Tipo do nome: ${typeof name}, Valor exato: "${name}"`);
                
                if (name && time !== undefined) {
                    const subserverDiv = document.createElement('div');
                    subserverDiv.className = 'subservidor';
                    subserverDiv.innerHTML = `
                        <span class="subservidor-name">${name}:</span>
                        <span class="subservidor-time">${String(time).padStart(2, '0')}</span>
                    `;
                    subserversContainer.appendChild(subserverDiv);
                }
            });
            
            // console.log('‚úÖ Dados dos subservidores carregados com sucesso');
            
            // Marca que os dados foram carregados com sucesso
            serverDataLoaded = true;
            
            // Atualiza o countdown timer com os novos dados
            updateCountdownTimer();
            
        } catch (error) {
            console.error('‚ùå Erro ao carregar os dados da planilha:', error);
            console.error('üîß Detalhes do erro:', error.message, error.stack);
            
            subserversContainer.innerHTML = '<p style="color: red;">Erro ao carregar os hor√°rios. Usando dados de teste...</p>';
            
            // Em caso de erro, usar dados mock para teste
            console.log('üß™ Usando dados de teste...');
            serverTimesData = [
                { Idhas: 'ALFA', Horario: '01' },
                { Idhas: 'BETA', Horario: '01' },
                { Idhas: 'GAMA', Horario: '01' },
                { Idhas: 'DELTA', Horario: '01' },
                { Idhas: 'EPSILON', Horario: '01' },
                { Idhas: 'ZETA', Horario: '01' },
                { Idhas: 'ETA', Horario: '01' },
                { Idhas: 'THETA', Horario: '01' },
                { Idhas: 'IOTA', Horario: '01' },
                { Idhas: 'KAPPA', Horario: '01' },
                { Idhas: 'LAMBDA', Horario: '01' },
                { Idhas: 'MI', Horario: '01' },
                { Idhas: 'NU', Horario: '01' },
                { Idhas: 'XI', Horario: '01' }
            ];
            
            // Reconstr√≥i a interface com dados de teste
            subserversContainer.innerHTML = '';
            serverTimesData.forEach(item => {
                const subserverDiv = document.createElement('div');
                subserverDiv.className = 'subservidor';
                subserverDiv.innerHTML = `
                    <span class="subservidor-name">${item.Idhas}:</span>
                    <span class="subservidor-time">${String(item.Horario).padStart(2, '0')} <small>(teste)</small></span>
                `;
                subserversContainer.appendChild(subserverDiv);
            });
            
            // Marca que os dados de teste foram carregados
            serverDataLoaded = true;
            
            updateCountdownTimer();
        }
    }

    function updateTimeDisplay() {
        const now = getSaoPauloDate()
        const timeZone = 'America/Sao_Paulo';

        // Crie um formatador para obter as partes da data e hora
        const formatter = new Intl.DateTimeFormat('en-US', {
            timeZone: timeZone,
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            hour12: false // Formato 24 horas
        });

        const parts = formatter.formatToParts(now);

        // Encontre e extraia as partes para o seu formato
        const year = parts.find(p => p.type === 'year').value;
        const month = parts.find(p => p.type === 'month').value;
        const day = parts.find(p => p.type === 'day').value;
        const hour = parts.find(p => p.type === 'hour').value;
        const minute = parts.find(p => p.type === 'minute').value;

        // Monte a string final com o formato desejado
        const formattedTime = `${year}-${month}-${day}  ${hour}:${minute}`;

        timeDisplay.textContent = `Data e Hora de refer√™ncia: ${formattedTime}`;
    }

    function getDropChance(boss, dropItemName) {
        if (!boss.drop) return 0;
        const dropString = boss.drop.join(' ');
        const regex = new RegExp(`${dropItemName}\\s*\\(([^)]+)%`, 'i');
        const match = dropString.match(regex);
        if (match && match[1]) {
            const chance = parseFloat(match[1].replace(',', '.'));
            return isNaN(chance) ? 0 : chance;
        }
        return 0;
    }

    function getNextAppearance(horarios) {
        const now = getSaoPauloDate();
        const currentHour = now.getHours();
        const sortedHorarios = horarios.slice().sort((a, b) => a - b);
        
        for (const horario of sortedHorarios) {
            if (horario >= currentHour) {
                return horario;
            }
        }
        return sortedHorarios[0] + 24;
    }

    // Update countdown timer
    function updateCountdownTimer() {
        // Se os dados ainda n√£o foram carregados, mostra estado de loading
        if (!serverDataLoaded) {
            countdownTimer.textContent = '‚è≥ Carregando...';
            nextBossName.textContent = 'Aguardando dados...';
            nextBossLocation.textContent = 'üì° Conectando com servidor...';
            return;
        }
        
        const nextBoss = findNextBossWithServerTimes();
        
        if (!nextBoss) {
            countdownTimer.textContent = '--:--:--';
            if (!serverTimesData || serverTimesData.length === 0) {
                nextBossName.textContent = 'Carregando dados...';
                nextBossLocation.textContent = 'üì° Aguardando hor√°rios de refer√™ncia...';
            } else {
                nextBossName.textContent = 'Nenhum boss encontrado';
                nextBossLocation.textContent = 'üìç Verifique os dados...';
            }
            return;
        }
        
        const now = getSaoPauloDate();
        const timeToNext = nextBoss.timeToNext;
        const hours = Math.floor(timeToNext / 60);
        const minutes = timeToNext % 60;
        const seconds = 60 - now.getSeconds();
        
        // Update display with server reference info
        const bossDisplayName = nextBoss.nome.replace('<br>', ' ');
        const serverInfo = nextBoss.subserver ? ` (${nextBoss.subserver})` : '';
        const spawnTimeInfo = nextBoss.spawnTime ? ` √†s ${nextBoss.spawnTime}` : '';
        
        nextBossName.innerHTML = `${bossDisplayName}${serverInfo}`;
        nextBossLocation.textContent = `üìç ${nextBoss.local}${spawnTimeInfo}`;
        
        const hoursDisplay = String(hours).padStart(2, '0');
        const minutesDisplay = String(minutes).padStart(2, '0');
        const secondsDisplay = String(seconds).padStart(2, '0');
        
        countdownTimer.textContent = `${hoursDisplay}:${minutesDisplay}:${secondsDisplay}`;
        
        // Add warning color if less than 10 minutes
        if (timeToNext <= 10) {
            countdownTimer.classList.add('warning-timer');
        } else {
            countdownTimer.classList.remove('warning-timer');
        }
        
        // Notifications
        const bossKey = `${nextBoss.nome}-${nextBoss.nextHour}-${nextBoss.nextMinute || 0}`;
        
        // Early warning (5 minutes before)
        if (earlyWarningEnabled && timeToNext === 5 && lastNotifiedBoss !== bossKey + '-early') {
            playNotificationSound('chime');
            const notificationTitle = `‚ö†Ô∏è ${bossDisplayName} aparecer√° em 5 minutos!`;
            const notificationBody = `${nextBoss.local}${spawnTimeInfo}${serverInfo}`;
            showNotification(notificationTitle, notificationBody, nextBoss.nome);
            lastNotifiedBoss = bossKey + '-early';
        }
        
        // Final warning (1 minute before)
        if (soundEnabled && timeToNext === 1 && lastNotifiedBoss !== bossKey + '-final') {
            playNotificationSound('alert');
            const notificationTitle = `üö® ${bossDisplayName} aparecer√° em 1 minuto!`;
            const notificationBody = `${nextBoss.local}${spawnTimeInfo}${serverInfo}`;
            showNotification(notificationTitle, notificationBody, nextBoss.nome);
            lastNotifiedBoss = bossKey + '-final';
        }
        
        // Boss spawned
        if (timeToNext === 0 && lastNotifiedBoss !== bossKey + '-spawn') {
            playNotificationSound('alert');
            const notificationTitle = `üêâ ${bossDisplayName} apareceu agora!`;
            const notificationBody = `${nextBoss.local}${spawnTimeInfo}${serverInfo}`;
            showNotification(notificationTitle, notificationBody, nextBoss.nome);
            lastNotifiedBoss = bossKey + '-spawn';
        }
    }

    // Request notification permission
    
    // ===== GLOBAL VARIABLES =====
    let showOnlyFavorites = false;

    // ===== USER PROFILE GLOBAL =====
    let userProfile = {
        favoritesBosses: [],
        soundSettings: {
            enabled: false,
            type: "beep",
            volume: 50,
            earlyWarning: false
        },
        notificationsEnabled: false,
        lastAccess: getSaoPauloDate().toISOString(),
        stats: {
            totalVisits: 0,
            favoritesCount: 0
        }
    };
    
    function renderBosses() {
        const selectedFilter = filterSelect.value;
        const selectedTimeFilter = timeFilterSelect.value;
        const selectedSort = sortSelect.value;

        // Passo 1: Filtrar os bosses por item
        let filteredBosses = allBossesData.filter(boss => {
            if (selectedFilter === 'all') {
                return true;
            }
            const dropString = boss.drop ? boss.drop.join(' ') : '';
            return dropString.includes(selectedFilter);
        });

        // Passo 1.5: Filtrar apenas favoritos se ativo
        if (showOnlyFavorites) {
            filteredBosses = filteredBosses.filter(boss => isFavorite(boss.nome));
        }

        // Passo 2: Filtrar os bosses por hor√°rio
        if (selectedTimeFilter !== 'all') {
            const hourToFilter = parseInt(selectedTimeFilter);
            filteredBosses = filteredBosses.filter(boss => {
                return boss.horarios.includes(hourToFilter);
            });
        }

        // Passo 3: Ordenar os bosses
        let sortedBosses = [...filteredBosses];

        if (selectedSort === 'next-spawn') {
            sortedBosses.forEach(boss => {
                boss.nextAppearance = getNextAppearance(boss.horarios);
            });
            sortedBosses.sort((a, b) => a.nextAppearance - b.nextAppearance);
        } else {
            sortedBosses.sort((a, b) => {
                const chanceA = getDropChance(a, selectedSort);
                const chanceB = getDropChance(b, selectedSort);
                return chanceB - chanceA; // Ordem decrescente de chance
            });
        }

        // Passo 4: Renderizar a lista
        bossesContainer.innerHTML = '';
        const currentHour = getSaoPauloDate().getHours();
        
        sortedBosses.forEach(info => {
            const bossCard = document.createElement('div');
            bossCard.className = 'boss-card';
            
            // Add favorite star
            const favoriteStar = document.createElement('div');
            favoriteStar.className = `favorite-star ${isFavorite(info.nome) ? 'favorited' : ''}`;
            favoriteStar.innerHTML = '‚≠ê';
            favoriteStar.title = isFavorite(info.nome) ? 'Remover dos favoritos' : 'Adicionar aos favoritos';
            favoriteStar.onclick = (e) => {
                e.stopPropagation();
                toggleFavorite(info.nome);
            };
            bossCard.appendChild(favoriteStar);

            const bossHeader = document.createElement('div');
            bossHeader.className = 'boss-header';

            const bossImage = document.createElement('img');
            bossImage.src = info.img;
            bossImage.alt = `Imagem de ${info.nome}`;
            bossImage.loading = 'lazy';
            
            const spawnImage = document.createElement('img');
            spawnImage.src = info.spaw;
            spawnImage.alt = `Mapa de ${info.nome}`;
            spawnImage.loading = 'lazy';
            spawnImage.className = 'boss-spawn-img';
            
            const bossTitle = document.createElement('h2');
            bossTitle.innerHTML = info.nome;
            
            bossHeader.appendChild(bossImage);            
            bossHeader.appendChild(bossTitle);
            bossHeader.appendChild(spawnImage);

            const bossInfo = document.createElement('div');
            bossInfo.className = 'boss-info';
            
            const horariosString = info.horarios.map(h => {
                const formattedHour = String(h).padStart(2, '0') + 'hXX';
                if (h === currentHour) {
                    return `<span class="highlight">${formattedHour}</span>`;
                }
                return formattedHour;
            }).join(', ');

            bossInfo.innerHTML = `
                <p><strong>Local:</strong> ${info.local}</p>
                <p><strong>Hor√°rios:</strong> ${horariosString}</p>
            `;

            const createList = (title, items) => {
                if (items && items.length > 0) {
                    const listTitle = document.createElement('h3');
                    listTitle.className = 'section-title';
                    listTitle.textContent = title;
                    bossInfo.appendChild(listTitle);

                    const ul = document.createElement('ul');
                    items.forEach(item => {
                        const li = document.createElement('li');
                        li.textContent = item;
                        ul.appendChild(li);
                    });
                    bossInfo.appendChild(ul);
                }
            };
            
            createList('Drops', info.drop);
            createList('Dano 1 (50.000 a 349.999)', info.dano1);
            createList('Dano 2 (350.000 a 999.999)', info.dano2);
            createList('Dano 3 (1.000.000 e superior)', info.dano3);

            bossCard.appendChild(bossHeader);
            bossCard.appendChild(bossInfo);
            bossesContainer.appendChild(bossCard);
        });
    }

    // Adiciona event listeners para os filtros
    filterSelect.addEventListener('change', renderBosses);
    timeFilterSelect.addEventListener('change', renderBosses);
    sortSelect.addEventListener('change', renderBosses);

    // Fun√ß√£o para trocar entre abas
    function switchTab(tabName) {
        // Remove active de todas as abas e conte√∫dos
        document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        
        // Adiciona active na aba clicada
        event.target.classList.add('active');
        
        // Mostra o conte√∫do correspondente
        document.getElementById(tabName + '-content').classList.add('active');
        
        // Se mudou para a aba de bosses, atualiza os dados
        if (tabName === 'bosses') {
            fetchServerTimes();
            renderBosses();
        }
    }


    // Torna a fun√ß√£o switchTab global para ser acess√≠vel pelos bot√µes
    window.switchTab = switchTab;


    // Load user profile from localStorage
    function loadProfile() {
        try {
            const saved = localStorage.getItem('ptBossesProfile');
            if (saved) {
                userProfile = { ...userProfile, ...JSON.parse(saved) };
                console.log('üìÅ Profile loaded:', userProfile);
            }
        } catch (error) {
            console.error('‚ùå Error loading profile:', error);
        }
        
        // Update profile stats display
        updateProfileDisplay();
        
        // Track visit
        userProfile.stats.totalVisits++;
        userProfile.lastAccess = getSaoPauloDate().toISOString();
        saveProfile();
    }

    // Save user profile to localStorage
    function saveProfile() {
        try {
            localStorage.setItem('ptBossesProfile', JSON.stringify(userProfile));
            updateProfileDisplay();
        } catch (error) {
            console.error('‚ùå Error saving profile:', error);
        }
    }

    // Update profile display
    function updateProfileDisplay() {
        document.getElementById('favorites-count').textContent = userProfile.favoritesBosses.length;
        document.getElementById('notification-status').textContent = userProfile.notificationsEnabled ? 'Habilitadas' : 'Desabilitadas';
        
        // Update notification button state
        const notificationBtn = document.getElementById('notification-toggle');
        if (notificationBtn) {
            if (userProfile.notificationsEnabled) {
                notificationBtn.textContent = 'üîî ON';
                notificationBtn.classList.add('active');
            } else {
                notificationBtn.textContent = 'üîî OFF';
                notificationBtn.classList.remove('active');
            }
        }
    }



    // ===== FAVORITES SYSTEM =====
    function toggleFavorite(bossName) {
        const index = userProfile.favoritesBosses.indexOf(bossName);
        if (index > -1) {
            userProfile.favoritesBosses.splice(index, 1);
        } else {
            userProfile.favoritesBosses.push(bossName);
        }
        saveProfile();
        renderBosses(); // Re-render to update stars
    }

    function isFavorite(bossName) {
        return userProfile.favoritesBosses.includes(bossName);
    }

    function toggleFavoritesFilter() {
        showOnlyFavorites = !showOnlyFavorites;
        const toggle = document.getElementById('favorites-toggle');
        
        if (showOnlyFavorites) {
            toggle.style.background = 'var(--text-accent)';
            toggle.style.color = 'var(--bg-primary)';
            toggle.title = 'Mostrar todos os bosses';
        } else {
            toggle.style.background = 'var(--bg-secondary)';
            toggle.style.color = 'var(--text-accent)';
            toggle.title = 'Mostrar favoritos';
        }
        
        renderBosses();
    }

    // ===== PROFILE PANEL =====
    function toggleProfilePanel() {
        const panel = document.getElementById('profile-panel');
        panel.classList.toggle('open');
    }

    function exportProfile() {
        const dataStr = JSON.stringify(userProfile, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        
        const link = document.createElement('a');
        link.href = URL.createObjectURL(dataBlob);
        link.download = 'pt-bosses-profile.json';
        link.click();
        
        console.log('üì§ Profile exported successfully');
    }

    function importProfile() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.json';
        
        input.onchange = function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const imported = JSON.parse(e.target.result);
                        userProfile = { ...userProfile, ...imported };
                        saveProfile();
                        renderBosses();
                        // console.log('üì• Profile imported successfully');
                        alert('‚úÖ Configura√ß√µes importadas com sucesso!');
                    } catch (error) {
                        console.error('‚ùå Error importing profile:', error);
                        alert('‚ùå Erro ao importar configura√ß√µes. Verifique o arquivo.');
                    }
                };
                reader.readAsText(file);
            }
        };
        
        input.click();
    }

    function clearProfile() {
        if (confirm('‚ö†Ô∏è Tem certeza que deseja limpar todos os seus dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
            localStorage.removeItem('ptBossesProfile');
            userProfile = {
                favoritesBosses: [],
                soundSettings: { enabled: false, type: 'beep', volume: 50, earlyWarning: false },
                notificationsEnabled: false,
                lastAccess: getSaoPauloDate().toISOString(),
                stats: { totalVisits: 0, favoritesCount: 0 }
            };
            updateProfileDisplay();
            renderBosses();
            // console.log('üóëÔ∏è Profile cleared');
            alert('‚úÖ Dados limpos com sucesso!');
        }
    }

    // Test notification function
    function testNotification() {
        if (!userProfile.notificationsEnabled) {
            alert('‚ùå Primeiro ative as notifica√ß√µes usando o bot√£o "üîî OFF" no timer!');
            return;
        }
        
        showNotification(
            'üß™ Teste de Notifica√ß√£o!', 
            'Se voc√™ viu esta notifica√ß√£o, est√° funcionando perfeitamente!',
            'Teste'
        );
        
        // Also play sound if enabled
        if (soundEnabled) {
            playNotificationSound('chime');
        }
    }

    // Help modal functions
    function showHelpModal() {
        const modal = document.getElementById('help-modal-overlay');
        modal.classList.add('show');
        // Prevent body scroll when modal is open
        document.body.style.overflow = 'hidden';
    }

    function closeHelpModal() {
        const modal = document.getElementById('help-modal-overlay');
        modal.classList.remove('show');
        // Restore body scroll
        document.body.style.overflow = 'auto';
    }

    // Close modal with Escape key
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
            closeHelpModal();
        }
    });

    // ===== PWA INSTALLATION =====
    let deferredPrompt;

    // Only show PWA install prompt when served via HTTP/HTTPS
    if (window.location.protocol !== 'file:') {
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent Chrome 67 and earlier from automatically showing the prompt
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show the install banner
            showPWABanner();
        });
    }

    function showPWABanner() {
        const banner = document.getElementById('pwa-banner');
        banner.style.display = 'block';
        
        document.getElementById('pwa-install-btn').addEventListener('click', installPWA);
    }

    function installPWA() {
        const banner = document.getElementById('pwa-banner');
        banner.style.display = 'none';
        
        if (deferredPrompt) {
            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('üì± User accepted the PWA install prompt');
                } else {
                    console.log('‚ùå User dismissed the PWA install prompt');
                }
                deferredPrompt = null;
            });
        }
    }

    function dismissPWABanner() {
        document.getElementById('pwa-banner').style.display = 'none';
    }

    // ===== ENHANCED NOTIFICATIONS =====
    async function requestNotificationPermission() {
        if ('Notification' in window) {
            console.log('üîî Solicitando permiss√£o de notifica√ß√£o...');
            const permission = await Notification.requestPermission();
            console.log('üìã Permiss√£o obtida:', permission);
            
            userProfile.notificationsEnabled = permission === 'granted';
            saveProfile();
            
            if (permission === 'granted') {
                // console.log('üîî Notifications enabled');
                // Show test notification
                new Notification('‚úÖ Notifica√ß√µes Habilitadas!', {
                    body: 'Voc√™ receber√° alertas sobre spawns dos bosses.',
                    icon: 'img/bosses/miniaturas/mini_babel.webp'
                });
            } else if (permission === 'denied') {
                console.log('‚ùå Usu√°rio negou permiss√£o para notifica√ß√µes');
                alert('‚ùå Voc√™ negou as notifica√ß√µes. Para ativar, clique no √≠cone de cadeado na barra de endere√ßos e permita notifica√ß√µes.');
            } else {
                console.log('‚è∏Ô∏è Usu√°rio dispensou a solicita√ß√£o de notifica√ß√£o');
            }
        } else {
            console.log('‚ùå Navegador n√£o suporta notifica√ß√µes');
            alert('‚ùå Seu navegador n√£o suporta notifica√ß√µes.');
        }
    }

    // Enhanced notification with favorites priority
    function showNotification(title, body, bossName = null) {
        console.log('üîî showNotification called:', {
            title,
            body,
            bossName,
            notificationsEnabled: userProfile.notificationsEnabled,
            permission: Notification.permission
        });
        
        if (!userProfile.notificationsEnabled) {
            console.log('‚ùå Notifica√ß√µes desabilitadas no perfil do usu√°rio');
            return;
        }
        
        // Priority notification for favorite bosses
        const isFavoriteBoss = bossName && isFavorite(bossName);
        
        if ('Notification' in window && Notification.permission === 'granted') {
            console.log('‚úÖ Criando notifica√ß√£o do navegador...');
            const notification = new Notification(title, {
                body: body,
                icon: 'img/bosses/miniaturas/mini_babel.webp',
                badge: 'img/bosses/miniaturas/mini_valento.webp',
                tag: `boss-${bossName}`,
                requireInteraction: isFavoriteBoss, // Keep favorite boss notifications until dismissed
                vibrate: isFavoriteBoss ? [200, 100, 200] : [100, 50, 100]
            });
            
            // Auto-close non-favorite notifications after 5 seconds
            if (!isFavoriteBoss) {
                setTimeout(() => notification.close(), 5000);
            }
        } else {
            console.log('‚ùå Notifica√ß√µes n√£o permitidas pelo navegador:', Notification.permission);
        }
    }



    let currentResults = [];

function toggleLotteryOptions() {
    const options = document.getElementById('lottery-options');
    const arrow = document.querySelector('.options-toggle .arrow');
    
    if (options.style.display === 'none') {
        options.style.display = 'block';
        arrow.textContent = '‚ñ≤';
    } else {
        options.style.display = 'none';
        arrow.textContent = '‚ñº';
    }
}

function generateNumbers(count, min, max, allowRepeats) {
    const numbers = [];
    const range = max - min + 1;
    
    if (!allowRepeats && count > range) {
        throw new Error(`N√£o √© poss√≠vel sortear ${count} n√∫meros √∫nicos entre ${min} e ${max}`);
    }
    
    if (allowRepeats) {
        for (let i = 0; i < count; i++) {
            numbers.push(Math.floor(Math.random() * range) + min);
        }
    } else {
        const available = Array.from({length: range}, (_, i) => min + i);
        for (let i = 0; i < count; i++) {
            const randomIndex = Math.floor(Math.random() * available.length);
            numbers.push(available.splice(randomIndex, 1)[0]);
        }
    }
    
    return numbers;
}

function displayResults(numbers) {
    const resultsDiv = document.getElementById('lottery-results');
    const display = document.getElementById('results-display');
    const timeSpan = document.getElementById('draw-time');
    
    const sortResults = document.getElementById('sort-results').checked;
    const finalNumbers = sortResults ? [...numbers].sort((a, b) => a - b) : numbers;
    
    display.innerHTML = '';
    
    finalNumbers.forEach((number, index) => {
        setTimeout(() => {
            const numberDiv = document.createElement('div');
            numberDiv.className = 'result-number';
            numberDiv.textContent = number;
            display.appendChild(numberDiv);
        }, index * 100);
    });
    
    timeSpan.textContent = getSaoPauloDate().toLocaleString('pt-BR');
    resultsDiv.style.display = 'block';
    currentResults = finalNumbers;
    
    // Scroll to results
    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
}

function copyResults() {
    if (currentResults.length === 0) return;
    
    const text = `N√∫meros sorteados: ${currentResults.join(', ')}\nData: ${getSaoPauloDate().toLocaleString('pt-BR')}`;
    
    navigator.clipboard.writeText(text).then(() => {
        // Simple feedback
        const btn = event.target;
        const originalText = btn.textContent;
        btn.textContent = 'Copiado!';
        btn.style.background = 'var(--text-accent)';
        btn.style.color = 'white';
        
        setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '';
            btn.style.color = '';
        }, 2000);
    }).catch(() => {
        alert('Erro ao copiar. Use Ctrl+C manualmente.');
    });
}

function newDraw() {
    document.getElementById('lottery-results').style.display = 'none';
    currentResults = [];
    
    // Reset form
    document.getElementById('quantity').value = 1;
    document.getElementById('min-range').value = 1;
    document.getElementById('max-range').value = 100;
}

// Form submission
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('lottery-form');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const quantity = parseInt(document.getElementById('quantity').value);
        const minRange = parseInt(document.getElementById('min-range').value);
        const maxRange = parseInt(document.getElementById('max-range').value);
        const allowRepeats = document.getElementById('allow-repeats').checked;
        
        // Validation
        if (quantity < 1 || quantity > 100) {
            alert('Quantidade deve ser entre 1 e 100');
            return;
        }
        
        if (minRange >= maxRange) {
            alert('O valor m√≠nimo deve ser menor que o m√°ximo');
            return;
        }
        
        try {
            const results = generateNumbers(quantity, minRange, maxRange, allowRepeats);
            displayResults(results);
        } catch (error) {
            alert(error.message);
        }
    });
});

// Make functions global
window.toggleLotteryOptions = toggleLotteryOptions;
window.copyResults = copyResults;
window.newDraw = newDraw;

    // ===== SERVICE WORKER REGISTRATION =====
    // Only register service worker when served via HTTP/HTTPS (not file://)
    if ('serviceWorker' in navigator && window.location.protocol !== 'file:') {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/service-worker.js')
                .then((registration) => {
                    console.log('‚úÖ SW registered: ', registration);
                })
                .catch((registrationError) => {
                    console.log('‚ùå SW registration failed: ', registrationError);
                });
        });
    }

    // Make functions global
    window.toggleFavorite = toggleFavorite;
    window.toggleFavoritesFilter = toggleFavoritesFilter;
    window.toggleProfilePanel = toggleProfilePanel;
    window.exportProfile = exportProfile;
    window.importProfile = importProfile;
    window.clearProfile = clearProfile;
    window.testNotification = testNotification;
    window.showHelpModal = showHelpModal;
    window.closeHelpModal = closeHelpModal;
    window.dismissPWABanner = dismissPWABanner;

    // Initialize profile system
    loadProfile();

    // Fun√ß√£o de inicializa√ß√£o ass√≠ncrona
    async function initializeSystem() {
        try {
            console.log('üöÄ Inicializando sistema...');
            
            // Inicializa sistemas b√°sicos imediatamente
            updateTimeDisplay();
            renderBosses();
            
            // Carrega dados dos subservidores e aguarda completar
            // console.log('‚è≥ Carregando dados dos subservidores...');
            await fetchServerTimes();
            
            // S√≥ ap√≥s carregar os dados, inicializa o countdown timer
            if (serverDataLoaded) {
                // console.log('‚úÖ Dados carregados, iniciando countdown timer...');
                updateCountdownTimer();
                
                // Set up intervals apenas ap√≥s dados carregados
                setInterval(updateCountdownTimer, 1000);
                setInterval(renderBosses, 60000);
                setInterval(updateTimeDisplay, 1000);
                
                // Re-fetch server data every 5 minutes
                setInterval(fetchServerTimes, 300000);
                
                // console.log('‚úÖ Sistema completamente inicializado');
            } else {
                // console.log('‚ö†Ô∏è Dados n√£o carregados, tentando novamente em 5 segundos...');
                setTimeout(initializeSystem, 5000);
            }
            
        } catch (error) {
            console.error('‚ùå Erro na inicializa√ß√£o:', error);
            
            // Mesmo com erro, inicializa o b√°sico
            updateTimeDisplay();
            
            // Tenta novamente em 10 segundos
            console.log('üîÑ Tentando novamente em 10 segundos...');
            setTimeout(initializeSystem, 10000);
        }
    }

    // Initialize all systems
    initializeSystem();
    
    // Initialize notifications after DOM is ready
    setTimeout(() => {
        requestNotificationPermission();
    }, 1000);

    // Find next boss to appear using server reference times
    function findNextBossWithServerTimes() {
        // console.log('üîç Debug: serverTimesData:', serverTimesData);
        // console.log('üì° serverDataLoaded:', serverDataLoaded);
        
        // Se os dados ainda n√£o foram carregados, retorna null
        if (!serverDataLoaded) {
            // console.log('‚è≥ Aguardando carregamento dos dados dos subservidores...');
            return null;
        }
        
        if (!serverTimesData || serverTimesData.length === 0) {
            // console.log('‚ö†Ô∏è Sem dados dos subservidores, usando fun√ß√£o original');
            // Fallback para a fun√ß√£o original se n√£o houver dados dos subservidores
            return findNextBossOriginal();
        }

        const now = getSaoPauloDate();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        
        // console.log(`üïê Hora atual: ${currentHour}:${String(currentMinute).padStart(2, '0')}`);
        
        let nextBoss = null;
        let minTimeToNext = Infinity;
        
        // Para cada servidor com hor√°rio de refer√™ncia
        serverTimesData.forEach(serverData => {
            const subserverName = serverData.Idhas;
            const referenceMinute = parseInt(serverData.Horario);
            
            // console.log(`üì° Processando servidor "${subserverName}": refer√™ncia ${referenceMinute}`);
            
            // TODOS os bosses nascem em TODOS os servidores
            // Ent√£o verifica cada boss em cada servidor
            allBossesData.forEach(boss => {
                // Para cada hor√°rio que este boss aparece
                boss.horarios.forEach(hour => {
                    // Calcula o hor√°rio real de spawn (hora fixa + minuto de refer√™ncia do servidor)
                    const spawnHour = hour;
                    const spawnMinute = referenceMinute;
                    const spawnTimeInMinutes = spawnHour * 60 + spawnMinute;
                    const currentTimeInMinutes = currentHour * 60 + currentMinute;
                    
                    let timeToNext;
                    
                    if (spawnTimeInMinutes > currentTimeInMinutes) {
                        // Boss vai nascer ainda hoje
                        timeToNext = spawnTimeInMinutes - currentTimeInMinutes;
                    } else {
                        // Boss vai nascer no pr√≥ximo dia
                        timeToNext = (24 * 60) - currentTimeInMinutes + spawnTimeInMinutes;
                    }
                    
                    // console.log(`üêâ ${boss.nome} em "${subserverName}" √†s ${String(spawnHour).padStart(2, '0')}:${String(spawnMinute).padStart(2, '0')} - Faltam ${timeToNext} minutos`);
                    
                    if (timeToNext < minTimeToNext) {
                        minTimeToNext = timeToNext;
                        
                        nextBoss = {
                            ...boss,
                            nextHour: spawnHour,
                            nextMinute: spawnMinute,
                            subserver: subserverName,
                            timeToNext: timeToNext,
                            spawnTime: `${String(spawnHour).padStart(2, '0')}:${String(spawnMinute).padStart(2, '0')}`
                        };
                        
                        // console.log(`‚úÖ Novo pr√≥ximo boss: ${nextBoss.nome} em "${subserverName}" √†s ${nextBoss.spawnTime}`);
                    }
                });
            });
        });
        
        // console.log('üéØ Resultado final:', nextBoss);
        return nextBoss;
    }

    // Fun√ß√£o original para fallback
    function findNextBossOriginal() {
        const now = getSaoPauloDate();
        const currentHour = now.getHours();
        const currentMinute = now.getMinutes();
        const currentTimeInMinutes = currentHour * 60 + currentMinute;
        
        let nextBoss = null;
        let minTimeToNext = Infinity;
        
        allBossesData.forEach(boss => {
            boss.horarios.forEach(hour => {
                const bossTimeInMinutes = hour * 60;
                let timeToNext;
                
                if (bossTimeInMinutes > currentTimeInMinutes) {
                    timeToNext = bossTimeInMinutes - currentTimeInMinutes;
                } else {
                    // Next day
                    timeToNext = (24 * 60) - currentTimeInMinutes + bossTimeInMinutes;
                }
                
                if (timeToNext < minTimeToNext) {
                    minTimeToNext = timeToNext;
                    nextBoss = {
                        ...boss,
                        nextHour: hour,
                        timeToNext: timeToNext
                    };
                }
            });
        });
        
        return nextBoss;
    }
</script>

</body>
</html> 